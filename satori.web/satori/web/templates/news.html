{% extends "templates/index.html" %}
{% load url from future %}
{% load bootstrap3 %}
{% block title %}
{% if page_info.contest %}
{{ page_info.contest.name }}
{% else %}
Main page
{% endif %}
{% endblock %}

{% block content %}
<p> 
    <span class="h3">News</span>
    <span class="pull-right"> 
    {% if page_info.contest_is_admin %}
    <a class="btn btn-default btn-sm" href="{% url 'contest_news_add' page_info.contest.id %}">Add news</a>
    {% endif %}

    {% if not page_info.contest and page_info.is_admin %}
    <a class="btn btn-default btn-sm" href="{% url 'news_add' %}">Add global news</a>
    {% endif %}
    </span>
</p>

{% for msg in messages %}
<div class = "panel panel-default">
    <div class="panel-heading panel-narrow">
            <strong>{{ msg.subpage.name }}</strong>
            <div class="pull-right">
            
                {% if msg.is_admin %}
                    {% if page_info.contest %}
                        {% if msg.subpage.contest %}
                            <a data-toggle="tooltip" title="Edit news" data-placement="top" href="{% url 'contest_news_edit' page_info.contest.id msg.subpage.id %}">{% bootstrap_icon "pencil" %}</a> 
                        {% endif %}
                    {% else %}
                        <a data-toggle="tooltip" title="Edit news" data-placement="top" href="{% url 'news_edit' msg.subpage.id %}">{% bootstrap_icon "pencil" %}</a>
                    {% endif %}
                {% endif %}

                {% if msg.subpage.is_public %}
                    <span data-toggle="tooltip" title="This is a public message." data-placement="top">{% bootstrap_icon "globe" %}</span>
                {% endif %}

                {% if msg.subpage.is_sticky %}
                    <span data-toggle="tooltip" title="This is a sticky message." data-placement="top">{% bootstrap_icon "star" %}</span>
                {% endif %}
                <small>
                    {{msg.subpage.date_created|date:"Y-m-d, H:i:s"}}
                </small>
            </div>
    </div>
            
    <div class="panel-body panel-narrow">
        {{ msg.html|safe }}
    </div>
</div>

    {% if can_edit %}
    <h5>Attachments</h5>
    <table>
        {% for afile in attachments %}
        <tr><td>
            <a href="{% url 'download_group' 'download' 'Subpage' subpage.id 'content_files' afile afile  %}">{{ afile }}</a>
        </td></tr>
        {% endfor %}
    </table>
    {% endif %}
{% endfor %}

{% endblock %}
