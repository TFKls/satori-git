{% extends "templates/index.html" %}
{% load url from future %}
{% load bootstrap3 %}

{% block header %}
<link rel="stylesheet" href="/files/results.css" />
{% endblock %}

{% block title %}
{{ page_info.contest.name }} - results
{% endblock %}

{% block content %}

<h4>Results</h4>


<div class="container-fluid">

<div class="col-md-9">
    {% with results as table %}
    {% include "pagination.html" %}
    {% endwith %}
    <form role="form" action="{% url 'results_diff' page_info.contest.id %}" method="get">
    <table class="table table-condensed table-bordered">
    <thead>
        <tr>
            <th class="cmp_button" colspan="2">
                <button class="btn btn-link">Compare submits</button>
            </th>
            <th rowspan="2">Number</th>
        {% if page_info.contest_is_admin %}            
            <th rowspan="2">Contestant</th> 
        {% endif %}
            <th rowspan="2">Time</th>
            <th rowspan="2" class="text-center">Problem</th>
            <th rowspan="2" class="text-center cell-narrow">Status {% if results.suite_show %}<i>({{ results.suite_show.name }})</i>{% endif %}</th>
        {% if results.enable_cmp %}
            <th rowspan="2" class="text-center cell-narrow">Status {% if results.suite_cmp %}<i>({{ results.suite_cmp.name }})</i>{% endif %}</th>
            <th rowspan="2" class="cell-narrow">Matching?</th>
        {% endif %}
        </tr>
        <tr>
            <th class="cmp_a">&nbsp;</th>
            <th class="cmp_b">&nbsp;</th>
        </tr>
    </thead>
    <tbody>
        {% for row in results.rows %}
        <tr>
            <td class="text-center"><input type="radio" name="cmp_a" value="{{row.id}}"/></td>
            <td class="text-center"><input type="radio" name="cmp_b" value="{{row.id}}"/></td>
            <td><a data-toggle="tooltip" title="View submit" href="{% url 'view_result' page_info.contest.id row.id %}">{{ row.id }} {% bootstrap_icon "search" %} </a></td>
        {% if page_info.contest_is_admin %}            
            <td><a href="{{ row.contestant_link }}">{{ row.contestant }}</a></td>
        {% endif %}
            <td class="text-center">{{ row.time|date:"Y-m-d H:i:s" }}</td>
            <td class="text-center"><a href="{{ row.problem_link }}">{{ row.problem }}</a></td>
            <td class="sta{{ row.status }} text-center cell-narrow">{{ row.status }}</td>
        {% if results.enable_cmp %}
            <td class="sta{{ row.status_cmp }} text-center cell-narrow">{{ row.status_cmp }}</td>
            <td class="text-center cell-narrow">{% if row.matching %} <span class="text-success">{% bootstrap_icon "ok" %}</span> {% else %} <span class="text-warning">{% bootstrap_icon "remove" %}</span> {% endif %}</td>
        {% endif %}
        </tr>
        {% endfor %}
    </tbody>

    </table></form>
</div>    

<div class="col-md-3">
    <div class="panel panel-default">
    <div class="panel-heading">
    Filters
    </div>
    <div class="panel-body">
        <form class="form form-vertical" role="form" action="{{ results.pagedata.nofilterlink }}" method="get">
            <div class="form-group form-group-sm">
            {% if page_info.contest_is_admin %}            
            <label for="results_contestant">Contestant: </label>
            <select class="form-control" name="results_contestant">
                <option value="">All contestants</option>
                {% for c in results.allcontestants %}
                <option value="{{ c.id }}" {% ifequal c.id|add:0 results.my_params.contestant|add:0 %} selected {% endifequal %}>
                    {{ c.name }}
                </option>
                {% endfor %}
            </select>
            {% endif %}

            <label for="results_problem">Problem: </label>
            <select class="form-control" name="results_problem">
                <option value="">All problems</option>
                {% for p in results.problems %}
                <option value="{{ p.problem_mapping.id }}" {% ifequal p.problem_mapping.id|add:0 results.my_params.problem|add:0 %} selected {% endifequal %}>
                    {{ p.problem_mapping.code }} &ndash; {{ p.problem_mapping.title }}

                </option>
                {% endfor %}
            </select>

            {% if page_info.contest_is_admin %}            
            <label for="results_suite_show">Show results for suite:</label>
            <select class="form-control" name="results_suite_show">
                <option value="">Default suite</option>
                {% for s in results.suites %}
                <option value="{{ s.id }}" {% ifequal s.id|add:0 results.my_params.suite_show|add:0 %} selected {% endifequal %}>
                    {{ s.name }}
                </option>
                {% endfor %}
            </select>
            {% endif %}
            
            <label for="results_status">Status: </label>
            <input type="text" class="form-control" name="results_status" value="{{results.status_filter}}"/>
            
            {% if page_info.contest_is_admin %}            
            <input type="checkbox" name="results_enable_cmp" {% if results.enable_cmp %} checked{% endif %}/>
            <label for="results_enable_cmp">Compare with suite:</label>
            <select class="form-control" name="results_suite_cmp">
                <option value="">Default suite</option>
                {% for s in results.suites %}
                <option value="{{ s.id }}" {% ifequal s.id|add:0 results.my_params.suite_cmp|add:0 %} selected {% endifequal %}>
                    {{ s.name }}
                </option>
                {% endfor %}
            </select>

            <input type="checkbox" name="results_only_diff" {% if results.only_diff %} checked{% endif %}/>
            Show only when different

            {% endif %}
            
            
            
            
            </div>
            
            <div class="form-group form-group-sm">
                <button type="submit" class="btn btn-primary btn-sm">Filter</button>
                <a href="{{ results.pagedata.nofilterlink }}" class="btn btn-link btn-sm">Clear filters</a>
            </div>
        </form>
    </div>
    </div>
</div>
    
</div>


{% endblock %}

