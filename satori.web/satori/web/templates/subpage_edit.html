{% extends "templates/index.html" %}

{% block content %}

{% if page_info.contest %}
<form action={% url contest_subpage_edit page_info.contest.id subpage.id %} method="POST" id="edit_form">
{% else %}
<form action={% url subpage_edit subpage.id %} method="POST" id="edit_form">
{% endif %}

{{ form.fid }}
<table class="subpage_form">
    <tr>
        <th><label for="id_name">{{ form.name.label }}</label></th>
        <td>{{ form.name }}</td>
        <td style="text-align: right"><input type="submit" value="Save changes"/></td>
    </tr>
    <tr>
        <th><label for="id_visibility">{{ form.visibility.label }}</label></th>
        <td>{{ form.visibility }}</td>
    </tr>
    {% if sphinxException %}
    <tr>
        <th></th>
        <td colspan="2" class="error_msg">{{ sphinxException }}</td>
    </tr>
    {% endif %}
    <tr>
        <th><label for="id_content">{{ form.content.label }}</label></th>
        <td colspan="2">{{ form.content }}</td>
    </tr>
    <tr>
        <th></th>
        <td colspan="2"><b>Quick Hint: </b><i>To include an image into a new document use: ".. image:: image.jpg". To create a link inside a new document use: "`link title &lt;link address&gt;`"</i>
        </td>
    </tr>
</table>
</form>

<h4>Attachments</h4>
<p>Click to select or drag-and-drop multiple files on the upload field:</p>
{% if page_info.contest %}
<form id="file_upload" action={% url contest_subpage_fileupload page_info.contest.id %} method="POST" enctype="multipart/form-data" class="file_upload">
{% else %}
<form id="file_upload" action={% url subpage_fileupload %} method="POST" enctype="multipart/form-data" class="file_upload">
{% endif %}
    <input type="file" name="file" multiple>
    {{ form.fid }}
    <button>Upload</button>
    <div>Add new files</div>
</form>

<table id="files">
    {% for dfile in attachments %}
    <tr> 
        <td><a href="{% url download_group 'download' 'Subpage' subpage.id 'content_files' dfile dfile %}">{{ dfile }}</a></td>
        <td>
        <form class="remove_existing">
            <input name="rfile" value="{{ dfile }}" type="hidden">
            <button class="ui-state-default ui-corner-all" type="submit">
                <span class="ui-icon ui-icon-trash"></span>
            </button>
        </form>
        </td>
    </tr>
    {% endfor %}
</table>
<script src="/files/scripts/attachments_upload.js"></script>
{% if page_info.contest %}
<script>createFileUploadInstance('{{ form.fid.value }}', '{% url contest_subpage_fileremove page_info.contest.id %}');</script>
{% else %}
<script>createFileUploadInstance('{{ form.fid.value }}', '{% url subpage_fileremove %}');</script>
{% endif %}
{% endblock %}
