{% extends "templates/index.html" %}

{% block content %}

{% if page_info.contest %}
<form action={% url contest_subpage_edit page_info.contest.id subpage.id %} method="POST" id="edit_form">
{% else %}
<form action={% url subpage_edit message.id %} method="POST" id="edit_form">
{% endif %}

<input name="fid" value="{{ fid }}" type="hidden">
<table class="subpage_form">
    <tr>
        <th><label for="id_name">Subpage name:</label></th>
        <td>{{ form.name }}</td>
        <td style="text-align: right"><input type="submit" value="Save changes"/></td>
    </tr>
    {% if sphinxException %}
    <tr>
        <th></th>
        <td colspan="2" class="error_msg">{{ sphinxException }}</td>
    </tr>
    {% endif %}
    <tr>
        <th><label for="id_content">Content:</label></th>
        <td colspan="2">{{ form.content }}</td>
    </tr>
    <tr>
        <th></th>
        <td colspan="2"><b>Quick Hint: </b><i>To include an image into a new document use: ".. image:: image.jpg". To create a link inside a new document use: "`link title &lt;link address&gt;`"</i>
        </td>
    </tr>
    <tr>
        <th><label for="id_is_public">Show to all visitors:</label></th>
        <td>{{ form.is_public }}</td>
    </tr>
</table>
</form>

<h4>Attachments</h4>
<p>Click to select or drag-and-drop multiple files on the upload field:</p>
<form id="file_upload" action={% url contest_subpage_fileupload page_info.contest.id %} method="POST" enctype="multipart/form-data" class="file_upload">
    <input type="file" name="file" multiple>
    <input name="fid" value="{{ fid }}" type="hidden">
    <button>Upload</button>
    <div>Add new files</div>
</form>

<table id="files">
    {% for dfile in attachments %}
    <tr> 
        <td><a href="{% url download_group 'download' 'Subpage' subpage.id 'content_files' dfile dfile %}">{{ dfile }}</a></td>
        <td>
        <form class="remove_existing">
            <input name="rfile" value="{{ dfile }}" type="hidden">
            <button class="ui-state-default ui-corner-all" type="submit">
                <span class="ui-icon ui-icon-trash"></span>
            </button>
        </form>
        </td>
    </tr>
    {% endfor %}
</table>
<script src="/files/scripts/attachments_upload.js"></script>
<script>createFileUploadInstance('{{ fid }}', '{% url contest_subpage_fileremove page_info.contest.id %}');</script>
{% endblock %}
